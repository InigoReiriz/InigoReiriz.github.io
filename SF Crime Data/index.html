<!DOCTYPE html>
<html lang="en">
   <head>
      <link href="css/mystyles.css" rel="stylesheet">
      <meta charset="utf-8">
      <title> SF Crime Data </title>
      <script type="text/javascript" src="../d3/d3.js"></script>
   </head>
   <body>
      <h1> Visualization 1: Prostitution and vehicle theft incidents per district in 2003 and 2015</h1>
      <p> The datasets correspond to the number of incidents of prostitution and vehicle theft per district in 
         San Francisco in years 2013 and 2015. Each point in the scatterplot corresponds to a district. The radius
         of a point in the scatterplot is proportional to the total number of crimes in that district. The x-axis 
         corresponds to the total number of prostitution incidents and the y-axis corresponds to the total number 
         of vehicle theft incidents. By clicking on the text we can toggle between data from 2013 and 2015. Note
         that axes do not change from one scatterplot to the other but they fit the data from both years. 
      </p>
      <button id="button2003" class="button" style="background-color:#DB7093;" >2003</button>
      <button id="button2015" class="button" >2015</button>
      <div id="area1"></div>
      <h1> Visualization 2: Number of prostitution and vehicle thefts in San Francisco from 2003 to 2015</h1>
      <p> The visualization consists of one histogram which is able to switch between two datasets. The first dataset
         contains the number of prostitution incidents in SF from 2003 to 2015. The second one contains the number of 
         vehicle theft incidents in the same time interval. By clicking on the text we can toggle between the two datasets.
      </p>
      <button id="buttonProst" class="button" style="background-color:#DB7093;" >Prostitution</button>
      <button id="buttonVtheft" class="button" >Vehicle Theft</button>
      <br> </br>
      <br> </br>
      <div id="area2"></div>
      <script type="text/javascript">
         /*########################### VISUALIZATION 1 ###############################*/
         
         //Making a scatterplot using D3
           //Width and height (size of the SVG)
           var w = 700;
           var h = 400;
           var padding = 60; //for element that are getting cutoff
           /*helps us push the elements away from the edges of SVG*/
         
           var dataset; //global variable
           var xScale;
           var yScale;
           var svg;
         
           //read data for year 2013
         d3.csv("data/SF_data_03.csv", function(error, data) {
             if (error) { //If error is not null, something went wrong.
                 console.log(error); //Log the error.
             } else { //If no error, the file loaded correctly. Yay!
             		dataset = data;
                	console.log(dataset)
              }
              scales(dataset);
              scatterplot(dataset);
              axis(dataset);
         });
         
         function scales(dataset){
         
         /*scale function for the x-axis*/
           /*note: d3.max function operates in arrays, not in objects. We can use d3.values(dataset) to extract all
           the values as an array.*/
           xScale = d3.scale.linear()
                         .domain([0, d3.max(d3.values(dataset), function(d) { return parseInt(d.prostitution); })])
                         .range([padding, w-padding * 2]); //padding fixing to avoid cutoff of the text
           
           /*scale function for the y-axis*/
           yScale = d3.scale.linear()
                         .domain([0, d3.max(d3.values(dataset), function(d) { return parseInt(d.vtheft); })])
                         .range([h-padding, padding]); //high values of y are at the top and low values at the bottom.
         }  
         
         function axis(dataset){
         
           /*label x axis*/
           var xAxis = d3.svg.axis()
                         .scale(xScale)
                         .orient("bottom") //where the labels should appear relative to the x-axis.
                         .ticks(10); //Set rough # of ticks
         
           /*label y axis*/
           var yAxis = d3.svg.axis()
                       .scale(yScale)
                       .orient("left")
                       .ticks(10);
         
         
           //Create X axis
           svg.append("g")
                     .attr("class", "axis") //Assign "axis" class to clean it up using CSS
                     .attr("transform", "translate(0," + (h - padding) + ")") /*transform the entire axis group pushing it
                     to the bottom.*/
                     .call(xAxis);
         
           //Create Y axis
           svg.append("g")
                     .attr("class", "axis")
                     .attr("transform", "translate(" + padding + ",0)")
                     .call(yAxis);
         }  
            
         function scatterplot(dataset){
         
           //Create SVG element
           svg = d3.select("#area1")
               	.append("svg")
               	.attr("width", w)
               	.attr("height", h);
         
           /*We make a circle for each data point. Our circles need cx, cy and r.*/
         
           svg.selectAll("circle") 
                 	.data(dataset)
                 	.enter()
                 	.append("circle")  
                 	.attr("cx", function(d) {
                       return xScale(parseInt(d.prostitution));
                 	})
                 	.attr("cy", function(d) {
                       return yScale(parseInt(d.vtheft));
                 	})
                 	.attr("r", function(d) {
                 		//substract by h so that the circles at the top are larger
                 return Math.sqrt((h - yScale(d.totalNumber)));
               })
               .attr('opacity', 0.3);
         
           //labels
           svg.selectAll("text") 
                 	.data(dataset)
                 	.enter()
                 	.append("text")
                 	.text(function(d) {
                     return d.district; 
                 	})
                 	.attr("x", function(d) {
                   	return xScale(parseInt(d.prostitution));
                	})
                 	.attr("y", function(d) {
                   	return yScale(parseInt(d.vtheft));
                 	})
                 	.attr("font-family", "sans-serif")
                 	.attr("font-size", "12px")
                 	.attr("fill", "#483D8B")
                 	.attr('opacity', 1);
         
         //On click, update with new data			
         d3.selectAll("#button2003, #button2015")
         .on("click", function() {
         //See which button was clicked
         var ID = d3.select(this).attr("id");
         
         //Decide which dataset to load
         if (ID == "button2015") {
               x = document.getElementById("button2003");
               x.style.backgroundColor = "white";
               x.style.color = "black";
               this.style.backgroundColor = "#DB7093";
               update_scatterplot("data/SF_data_15.csv");
         }
         else{
               x = document.getElementById("button2015");
               x.style.backgroundColor = "white";
               x.style.color = "black";
               this.style.backgroundColor = "#DB7093";
               update_scatterplot("data/SF_data_03.csv");
         }	
         });
         
         }
         
         function update_scatterplot(filename){
         
           //Overwrite dataset
            d3.csv(filename, function(error, data) {
             	if (error) { //If error is not null, something went wrong.
                 	console.log(error); //Log the error.
             	} else { //If no error, the file loaded correctly. Yay!
             		dataset = data;
                	console.log(dataset)
              	}
         
            svg.selectAll("circle")
                    .data(dataset)
                    .transition()
                    .duration(1500)
                    .ease("linear")
                    .attr("cx", function(d) {
                         return xScale(parseInt(d.prostitution));
                    })
                    .attr("cy", function(d) {
                         return yScale(parseInt(d.vtheft));
                    })
                    .attr("r", function(d) {
                         //substract by h so that the circles at the top are larger
                         return Math.sqrt((h - yScale(d.totalNumber)));
                    })
                    .attr('opacity', 0.3);
         
            svg.selectAll("text")
                     .data(dataset)
                     .transition()
                     .duration(1500)
                     .ease("linear")
                     .text(function(d) {
                       	   return d.district; 
                     })
                     .attr("x", function(d) {
                           return xScale(parseInt(d.prostitution));
                     })
                     .attr("y", function(d) {
                           return yScale(parseInt(d.vtheft));
                     })
                     .attr("font-family", "sans-serif")
                     .attr("font-size", "12px")
                     .attr("fill", "#483D8B")
                     .attr('opacity', 1);
         		});	
         }
         
         /*################## VISUALIZATION 2 #########################*/
         
          //global variables
          var barPadding = 1; 
          var w_hist = 500;
          var h_hist = 200;
          var yScale_hist;
         
          d3.csv("data/prost.csv", function(error, data) {
              if (error) { //If error is not null, something went wrong.
                   console.log(error); //Log the error.
              } else { //If no error, the file loaded correctly. Yay!
                   dataset = data;
                   console.log(dataset)
                   scale_hist(dataset);
                   histogram(dataset);
               }
          });
         
         
          function scale_hist(dataset){
           
          		/*scale function for the y-axis*/
          		yScale_hist = d3.scale.linear()
                           .domain([0, d3.max(d3.values(dataset), function(d) { return parseInt(d.incidents); })])
                           .range([h_hist-barPadding, barPadding]); //high values of y are at the top and low values at the bottom.
          }
         
          function histogram(dataset){
         
               //Create SVG element
               svg2 = d3.select("#area2")
                 .append("svg")
                 .attr("width", w_hist)
                 .attr("height", h_hist);
         
               svg2.selectAll("rect")
                   .data(dataset)
                   .enter()
                   .append("rect")
                   .attr({
                       x: function(d, i) { return i * (w_hist / dataset.length); },
                       y: function(d) { return ((yScale_hist(parseInt(d.incidents)))); },
                       width: w_hist / dataset.length - barPadding,
                       height: function(d) { return yScale_hist(parseInt(d.incidents)) + h_hist ; },
                       fill: function(d) { return "rgb(0, 0, " + (parseInt(d.incidents)) + ")"; }
         
         			});
         
               svg2.selectAll("text")
               	   .data(dataset)
               	   .enter()
                .append("text")
                .text(function(d) {
                  	return d.incidents;
                })
                .attr("x", function(d, i) {
                  	return i * (w_hist / dataset.length) + 5;
                })
                .attr("y", function(d) {
                  	return yScale_hist(parseInt(d.incidents)) + 15;
                })
                .attr("font-family", "sans-serif")
                .attr("font-size", "12px")
                .attr("fill", "white");
         
                	//On click, update with new data			
         d3.selectAll("#buttonProst, #buttonVtheft")
         .on("click", function() {
         //See which button was clicked
         var ID = d3.select(this).attr("id");
         
         //Decide which dataset to load
         if (ID == "buttonVtheft") {
               v = document.getElementById("buttonVtheft");
               v.style.backgroundColor = "white";
               v.style.color = "black";
               this.style.backgroundColor = "#DB7093";
               update_hist("data/vtheft.csv");
         }
         else{
               v = document.getElementById("buttonProst");
               v.style.backgroundColor = "white";
               v.style.color = "black";
               this.style.backgroundColor = "#DB7093";
               update_hist("data/prost.csv");
         }	
         });
         }
         
         function update_hist(filename){
         
         	//Overwrite dataset
            d3.csv(filename, function(error, data) {
             	if (error) { //If error is not null, something went wrong.
                 	console.log(error); //Log the error.
             	} else { //If no error, the file loaded correctly. Yay!
             		dataset = data;
                	console.log(dataset)
              	}
         
              	scale_hist(dataset)
         
                 svg2.selectAll("rect")
                   .data(dataset)
                   .transition()
                   .duration(1500)
                   .ease("linear")
                   .attr({
                       x: function(d, i) { return i * (w_hist / dataset.length); },
                       y: function(d) { return ((yScale_hist(parseInt(d.incidents)))); },
                       width: w_hist / dataset.length - barPadding,
                       height: function(d) { return yScale_hist(parseInt(d.incidents)) + h_hist ; },
                       fill: function(d) { return "rgb(0, 0, " + (parseInt(d.incidents)) + ")"; }
                   });
         
         		 
                 svg2.selectAll("text")
                   .data(dataset)
                   .transition()
                   .duration(1500)
                   .ease("linear")
                   .text(function(d) {
                     return d.incidents;
                   })
                   .attr("x", function(d, i) {
                     return i * (w_hist / dataset.length) + 2.5;
                   })
                   .attr("y", function(d) {
                     return yScale_hist(parseInt(d.incidents)) + 15;
                   })
                   .attr("font-family", "sans-serif")
                   .attr("font-size", "12px")
                   .attr("fill", "white");
               });
         }
                 
      </script>
   </body>
</html>