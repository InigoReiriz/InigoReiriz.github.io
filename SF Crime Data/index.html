<!DOCTYPE html>
<html lang="en">
   <head>
      <link href="css/mystyles.css" rel="stylesheet">
      <meta charset="utf-8">
      <title> SF Crime Data </title>
      <script type="text/javascript" src="../d3/d3.js"></script>
   </head>
   <body>
      <h1> Visualization 1: Prostitution and vehicle theft incidents per district in 2003 and 2015</h1>
      <p> The datasets correspond to the number of incidents of prostitution and vehicle theft per district in 
         San Francisco in years 2013 and 2015.
      <li> Each point in the scatterplot corresponds to a district.</li>
      <li> The radius of a point in the scatterplot is proportional to the total number of crimes in that district.</li>
      <li> The x-axis corresponds to the total number of prostitution incidents</li>
      <li> The y-axis corresponds to the total number of vehicle theft incidents.</li>
      <li> By clicking on the buttons we can toggle between data from 2013 and 2015. </li>
      <li> Note that axes do not change from one scatterplot to the other but they fit the data from both years. </li>
      </p>
      <button id="button2003" class="button" style="background-color:#DB7093;" >2003</button>
      <button id="button2015" class="button" >2015</button>
      <br> </br>
      <div id="area1"></div>
      <h1> Visualization 2: Number of prostitution, vehicle thefts and weapon incidents in San Francisco from 2003 to 2015</h1>
      <p> The datasets correspond to the number of incidents of prostitution, vehicle thefts and weapon laws from 2003 to 2015. 
      <li> The visualization consists of one histogram which is able to switch between three datasets.</li>
      <li> By clicking on the buttons we can toggle between the three datasets. </li>
      <li> We can hover over the bars to see the number of incidents. </li>
      </p>
      <button id="buttonProst" class="button" style="background-color:#008CBA;" >Prostitution</button>
      <button id="buttonVtheft" class="button"> Vehicle Theft</button>
      <button id="buttonWeapons" class="button"> Weapon Laws </button>
      <br> </br>
      <br> </br>
      <div id="area2"></div>
      <br> </br>
      <br> </br>
      <script type="text/javascript">
         /*########################### VISUALIZATION 1 ###############################*/
         
         //Making a scatterplot using D3
           //Width and height (size of the SVG)
           var w = 800;
           var h = 500;
           var padding = 60; //for element that are getting cutoff
           /*helps us push the elements away from the edges of SVG*/
         
           var dataset; //global variable
           var xScale;
           var yScale;
           var svg;
         
           //read data for year 2013
         d3.csv("data/SF_data_03.csv", function(error, data) {
             if (error) { //If error is not null, something went wrong.
                 console.log(error); //Log the error.
             } else { //If no error, the file loaded correctly. Yay!
             		dataset = data;
                	console.log(dataset)
              }
              scales(dataset);
              scatterplot(dataset);
              axis(dataset);
         });
         
         function scales(dataset){
         
           /*scale function for the x-axis*/
           /*note: d3.max function operates in arrays, not in objects. We can use d3.values(dataset) to extract all
           the values as an array.*/
           xScale = d3.scale.linear()
                         .domain([0, d3.max(d3.values(dataset), function(d) { return parseInt(d.prostitution); })])
                         .range([padding, w-padding * 2]); //padding fixing to avoid cutoff of the text
           
           /*scale function for the y-axis*/
           yScale = d3.scale.linear()
                         .domain([0, d3.max(d3.values(dataset), function(d) { return parseInt(d.vtheft); })])
                         .range([h-padding, padding]); //high values of y are at the top and low values at the bottom.
         }  
         
         function axis(dataset){
         
           /*label x axis*/
           var xAxis = d3.svg.axis()
                         .scale(xScale)
                         .orient("bottom") //where the labels should appear relative to the x-axis.
                         .ticks(10); //Set rough # of ticks         
           /*label y axis*/
           var yAxis = d3.svg.axis()
                       .scale(yScale)
                       .orient("left")
                       .ticks(10);         
         
           //Create X axis
           svg.append("g")
                     .attr("class", "axis") //Assign "axis" class to clean it up using CSS
                     .attr("transform", "translate(0," + (h - padding) + ")") /*transform the entire axis group pushing it
                     to the bottom.*/
                     .call(xAxis)
                     .append("text")
			         .attr("class", "label")
			         .attr("x", w - padding * 2)
			         .attr("y", -6)
			         .style("text-anchor", "end")
			         .text("PROSTITUTION");
         
         
           //Create Y axis
           svg.append("g")
                     .attr("class", "axis")
                     .attr("transform", "translate(" + padding + ",0)")
                     .call(yAxis)
                     .append("text")
			         .attr("class", "label")
			         .attr("transform", "rotate(-90)")
			         .attr("y", 4)
			         .attr("dy", ".71em")
			         .style("text-anchor", "end")
			         .text("VTHEFT");
         }  
            
         function scatterplot(dataset){
         
           //Create SVG element
           svg = d3.select("#area1")
               	.append("svg")
               	.attr("width", w)
               	.attr("height", h);
         
           /*We make a circle for each data point. Our circles need cx, cy and r.*/
         
           svg.selectAll("circle") 
                 	.data(dataset)
                 	.enter()
                 	.append("circle")  
                 	.attr("cx", function(d) {
                       return xScale(parseInt(d.prostitution));
                 	})
                 	.attr("cy", function(d) {
                       return yScale(parseInt(d.vtheft));
                 	})
                 	.attr("r", function(d) {
                 		//substract by h so that the circles at the top are larger
                 return Math.sqrt((h - yScale(d.totalNumber)));
               })
               .attr('opacity', 0.3);
         
           //labels
           svg.selectAll("text") 
                 	.data(dataset)
                 	.enter()
                 	.append("text")
                 	.text(function(d) {
                     return d.district; 
                 	})
                 	.attr("x", function(d) {
                   	return xScale(parseInt(d.prostitution));
                	})
                 	.attr("y", function(d) {
                   	return yScale(parseInt(d.vtheft));
                 	})
                 	.attr("font-family", "sans-serif")
                 	.attr("font-size", "12px")
                 	.attr("fill", "#483D8B")
                 	.attr('opacity', 1);
         
	         //On click, update with new data			
	         d3.selectAll("#button2003, #button2015")
	         .on("click", function() {
			         //See which button was clicked
			         var ID = d3.select(this).attr("id");
		         
			         //Decide which dataset to load
			         if (ID == "button2015") {
			               x = document.getElementById("button2003");
			               x.style.backgroundColor = "white";
			               x.style.color = "black";
			               this.style.backgroundColor = "#DB7093";
			               update_scatterplot("data/SF_data_15.csv");
			         }
			         else{
			               x = document.getElementById("button2015");
			               x.style.backgroundColor = "white";
			               x.style.color = "black";
			               this.style.backgroundColor = "#DB7093";
			               update_scatterplot("data/SF_data_03.csv");
			         }	
         	});
         
         }
         
         function update_scatterplot(filename){
         
           //Overwrite dataset
            d3.csv(filename, function(error, data) {
             	if (error) { //If error is not null, something went wrong.
                 	console.log(error); //Log the error.
             	} else { //If no error, the file loaded correctly. Yay!
             		dataset = data;
                	console.log(dataset)
              	}
         
            svg.selectAll("circle")
                    .data(dataset)
                    .transition()
                    .duration(1500)
                    .ease("linear")
                    .attr("cx", function(d) {
                         return xScale(parseInt(d.prostitution));
                    })
                    .attr("cy", function(d) {
                         return yScale(parseInt(d.vtheft));
                    })
                    .attr("r", function(d) {
                         //substract by h so that the circles at the top are larger
                         return Math.sqrt((h - yScale(d.totalNumber)));
                    })
                    .attr('opacity', 0.3);
         
            svg.selectAll("text")
                     .data(dataset)
                     .transition()
                     .duration(1500)
                     .ease("linear")
                     .text(function(d) {
                       	   return d.district; 
                     })
                     .attr("x", function(d) {
                           return xScale(parseInt(d.prostitution));
                     })
                     .attr("y", function(d) {
                           return yScale(parseInt(d.vtheft));
                     })
                     .attr("font-family", "sans-serif")
                     .attr("font-size", "12px")
                     .attr("fill", "#483D8B")
                     .attr('opacity', 1);
         		});	
         }
         
         /*################## VISUALIZATION 2 #########################*/
         
         //global variables
         var margin = {top: 20, right: 20, bottom: 30, left: 60},
         width = 700 - margin.left - margin.right,
         height = 400 - margin.top - margin.bottom;
         var x;
         var y;
         var xAxis_hist;
         var yAxis_hist;
         var svg2;
         
         // add the tooltip area to the webpage
         var tooltip = d3.select("#area2").append("div")
         .attr("class", "tooltip")
         .style("opacity", 0);
         
          d3.csv("data/prost.csv", function(error, data) {
              if (error) { //If error is not null, something went wrong.
                   console.log(error); //Log the error.
              } else { //If no error, the file loaded correctly. Yay!
         
                   dataset = data;
                   // Coerce the data to numbers.
         			dataset.forEach(function(d) {
         			d.year = +d.year;
         			d.incidents = +d.incidents;
         	  });
                   scale_hist(dataset);
                   histogram(dataset);
                   axis_hist(dataset);
                   append_axis(dataset);
               }
          });
         
         
          function scale_hist(dataset){
           
          		/*scale function for the y-axis*/
          		 x = d3.scale.ordinal()
		         .rangeRoundBands([0, width], .1);
		         
		         y = d3.scale.linear()
		         .range([height, 0]);
		         
		         x.domain(dataset.map(function(d) { return d.year; }));
		         y.domain([0, d3.max(dataset, function(d) { return d.incidents; })]);
          }
         
          function axis_hist(dataset){
         
		         xAxis_hist = d3.svg.axis()
		         .scale(x)
		         .orient("bottom");
		         
		         yAxis_hist = d3.svg.axis()
		         .scale(y)
		         .orient("left")
		         .ticks(10);
         }
         
         function append_axis(dataset){
         
		         svg2.append("g")
		         .attr("class", "x axis")
		         .attr("transform", "translate(0," + height + ")")
		         .call(xAxis_hist);
		         
		         
		           svg2.append("g")
		         .attr("class", "y axis")
		         .call(yAxis_hist)
         }
         
         function histogram(dataset){
         
                 //Create SVG element
		         svg2 = d3.select("#area2").append("svg")
		         .attr("width", width + margin.left + margin.right)
		         .attr("height", height + margin.top + margin.bottom)
		         .append("g")
		         .attr("transform", "translate(" + margin.left + "," + margin.top + ")");    
         
	         	svg2.selectAll(".bar")
	                   .data(dataset)
	                   .enter()
	                   .append("rect")
	                   .attr("class", "bar")
	                      .attr("x", function(d) { return x(d.year); })
				          .attr("width", x.rangeBand())
				          .attr("y", function(d) { return y(d.incidents); })
				          .attr("height", function(d) { return height - y(d.incidents); });
         
         
	          d3.selectAll("rect")
	         	.on("mouseover", function(d) {
         			tooltip.transition()
         				.duration(200)		
                	    .style("opacity", .9);	
        			 tooltip.html(d.incidents)
         				.style("left", (d3.event.pageX) + "px")		
                		.style("top", (d3.event.pageY - 28) + "px");	
         		})
         		.on("mouseout", function(d) {
         			tooltip.transition()
         				.duration(500)
         				.style("opacity", 0);
         		});
         
          		//On click, update with new data			
             	d3.selectAll("#buttonProst, #buttonVtheft, #buttonWeapons")
               		.on("click", function() {
               			//See which button was clicked
               			var ID = d3.select(this).attr("id");
               
			               //Decide which dataset to load
			               if (ID == "buttonProst") {
			               		color = "#008CBA";
			               		x = document.getElementById("buttonVtheft");
					         	x.style.backgroundColor = "white";
					         	x.style.color = "black";
					         	y = document.getElementById("buttonWeapons");
					         	y.style.backgroundColor = "white";
					         	y.style.color = "black";
					         	this.style.backgroundColor = color;
					          	update_hist("data/prost.csv", color);
			               }

               			   else if (ID == "buttonVtheft"){
               					color = "#2E8B57"
               					x = document.getElementById("buttonWeapons");
         						x.style.backgroundColor = "white";
         						x.style.color = "black";
         						y = document.getElementById("buttonProst");
         						y.style.backgroundColor = "white";
         						y.style.color = "black";
         						this.style.backgroundColor = color;
                  				update_hist("data/vtheft.csv", color);
               				}

               			   else if (ID == "buttonWeapons"){
               					color = "#B22222"
               					x = document.getElementById("buttonProst");
         						x.style.backgroundColor = "white";
         						x.style.color = "black";
         						y = document.getElementById("buttonVtheft");
         						y.style.backgroundColor = "white";
         						y.style.color = "black";
         						this.style.backgroundColor = color;
               					update_hist("data/weapons.csv", color);
               				}	
         				});
         
         }
         
         function update_hist(filename, color){
         
         	//Overwrite dataset
            d3.csv(filename, function(error, data) {
             	if (error) { //If error is not null, something went wrong.
                 	console.log(error); //Log the error.
             	} else { //If no error, the file loaded correctly. Yay!
             		dataset = data;
             		// Coerce the data to numbers.
			         dataset.forEach(function(d) {
			         d.year = +d.year;
			         d.incidents = +d.incidents;
         		});
            }
         
              	scale_hist(dataset)
         
                 svg2.selectAll(".bar")
                   .data(dataset)
                   .transition()
                   .duration(2500)
                   .ease("elastic")
                    .attr("class", "bar")
                    .attr("x", function(d) { return x(d.year); })
			        .attr("width", x.rangeBand())
			        .attr("y", function(d) { return y(d.incidents); })
			        .attr("height", function(d) { return height - y(d.incidents); })
			        .style("fill", color);
         
          	axis_hist(dataset);
         
	         //Update X axis
	         svg2.select(".x.axis")
	         .transition()
	         .duration(1000)
	         .call(xAxis_hist);
	         
	         //Update Y axis
	         svg2.select(".y.axis")
	         .transition()
	         .duration(1000)
	         .call(yAxis_hist);
                		          
         });
         
         }
                 
      </script>
   </body>
</html>