<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="utf-8">
      <title>Visualizing geodata</title>
      <script type="text/javascript" src="../d3/d3.js"></script>
  </head>
  <body>
      <script type="text/javascript">

          /*######## Creating Bounding Box ############*/

          var projection = d3.geo.mercator();

          //global variables
          var margin = {top: 20, right: 20, bottom: 30, left: 60},
          width = 1000 - margin.left - margin.right,
          height = 700 - margin.top - margin.bottom;

          var lattop = 37.831575;
          var lonleft = -122.514949;
          var lonright = -120.906983;
  
          // make the scale so that the difference of longitude is 
          // exactly the width of the image
          var scale = 360*width/(lonright-lonleft);
          projection.scale(scale);

          // translate the origin of the map to [0,0] as a start, 
          // not to the now meaningless default of [480,250]
          projection.translate([0,0]);

          // check where your top left coordinate is projected
          var trans = projection([lonleft,lattop]);
          // translate your map in the negative direction of that result
          projection.translate([-1*trans[0],-1*trans[1]]);

          var path = d3.geo.path()
                          .projection(projection);

          //Create SVG element
          svg = d3.select("body").append("svg")
             .attr("width", width + margin.left + margin.right)
             .attr("height", height + margin.top + margin.bottom)
             .append("g")
             .attr("transform", "translate(" + margin.left + "," + margin.top + ")"); 

          //sfpddistricts.geojson
          d3.json("data/sfpddistricts.geojson.json", function(json) {
              svg.selectAll("path")
              .data(json.features)
              .enter()
              .append("path")
              .attr("d", path)
              .style("fill", "steelblue");

              svg.selectAll("text")
                .data(json.features)
                .enter()
                .append("svg:text")
                .text(function(d){
                    return d.properties.DISTRICT;
                })
                .attr("x", function(d){
                    return path.centroid(d)[0];
                })
                .attr("y", function(d){
                    return  path.centroid(d)[1];
                })
                .attr("text-anchor","middle")
                .attr('font-size','15px')
                .attr('font-family','sans-serif')
                .attr('fill','black');

                d3.csv("data/lat_lon.csv", function(data) {
                    svg.selectAll("circle")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("cx", function(d) {
                        return projection([d.lon, d.lat])[0];
                    })
                    .attr("cy", function(d) {
                        return projection([d.lon, d.lat])[1];
                    })  
                    .attr("r", 5)
                    .style("fill", "green")
                    .style("opacity", 0.75);
              });
          });

      </script>
  </body>
</html>