<!DOCTYPE html>
<meta charset="utf-8">
<title></title>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<style>
.buttonText {
    font-size:12px;
    font-family: Helvetica, Arial, sans-serif;
    pointer-events:none;
}
.button {
    cursor: pointer;
}
#horizontalfold{
    margin-top: 100px;
    margin-left: 200px;
}

#title{
    margin-top: 100px;
    margin-left: 400px;
    color: #6495ED;
}

</style>
<body>
<div id="title">
    <h1> Welcome to SHUTE's data interface! </h1>
</div>
<div id="horizontalfold"></div>
<script>

var width = 960,
    height = 500;

var svg = d3.select("#horizontalfold").append("svg")
    .attr("width", width)
    .attr("height", height);


var buttonTexts = ["13-12-2016", "14-12-2016", "15-12-2016", "16-12-2016", "17-12-2016", "18-12-2016", "19-12-2016"];

var x = d3.scale.linear()
    .domain([0,buttonTexts.length+1])
    .range([0,width]);

var buttonWidth = x(1)-x(0);
var buttonPadding = 2;
var buttonMouseover = false;
var activeButtonId = Math.round((buttonTexts.length-1)/2);

var buttons = d3.range(buttonTexts.length).map(function(d,i) {
    return { 
        id: i+1,
        text:buttonTexts[i],
        x: calcXPosition(i),
        xHover: x(i+1) - buttonWidth/2,
        y: height/2,
        width: calcWidth(i),
        widthHover: buttonWidth - buttonPadding
    }
});

function calcXPosition(i) {
    var xValue = width/2 + (i - (buttonTexts.length-1)/2) * buttonPadding*2;
    if (i > activeButtonId) xValue += buttonWidth - buttonPadding*2;
    return xValue - buttonWidth/2;
}

function calcWidth(i) {
    if (i === activeButtonId) return buttonWidth - buttonPadding;
    return 2;
}

var mouseOverArea = svg.append("rect")
    .attr("id", "mouseOverArea")
    .attr("opacity", 0)
    .attr("width", 160)
    .attr("height", 32)
    .attr("x", function(d,i) { return width/2 - this.width.animVal.value / 2; } )
    .attr("y", height/2 - 16)
    .on("mouseover", function(d,i) {
        d3.select(this).transition()
            .attr("width", width)
            .attr("x", width/2 - width/2 );
        d3.selectAll(".buttonContainer").transition().attr("transform", function(d) { return "translate("+d.xHover+","+d.y+")"; } );
        d3.selectAll(".button").transition().attr("width", function(d) { return d.widthHover; });
        d3.selectAll(".buttonText.inactive").transition().attr("x", function(d) { return d.widthHover/2; }).attr("opacity", 1);
    })
    .on("mouseout", function(d,i) {
        if (!buttonMouseover) {
            d3.select(this).transition()
                .attr("width", 160)
                .attr("x", width/2 - 80);
            d3.selectAll(".buttonContainer").transition().attr("transform", function(d) { return "translate("+d.x+","+d.y+")"; });
            d3.selectAll(".button").transition().attr("width", function(d) { return d.width; })
            d3.selectAll(".buttonText.inactive").transition().attr("x", function(d) { return d.width/2; }).attr("opacity", 0);
        }
    });

var buttonContainer = svg.selectAll("g")
    .data(buttons)
  .enter().append("g")
    .attr("class", "buttonContainer")
    .attr("id", function(d,i) { return "group"+i; })
    .attr("transform", function(d) {
        return "translate("+d.x+","+d.y+")";
    });

var color = d3.scale.category10();

 function dblclick(a){
    window.location.assign("chart.html", '_blank');
 }

buttonContainer.append("rect")
    .attr("id", function(d,i) { return "button"+i; })
    .attr("class", "button")
    .attr("width", function(d) { return d.width; })
    .attr("height", 30)
    .attr("y", -15)
    .attr("fill", function(d,i) { return color(i); })
    .on("mouseover", function(d,i) {
        buttonMouseover = true;
        $("#mouseOverArea").mouseevent("mouseover");
            d3.select(this).attr("fill", function(d,i) { return d3.rgb(color(d.id-1)).darker(1); })
            .on("click", dblclick);


    })
    .on("mouseout", function(d,i) {
        buttonMouseover = false;
        $("#mouseOverArea").mouseevent("mouseout");
            d3.select(this).attr("fill", function(d,i) { return color(d.id-1); })
    } );

buttonContainer.append("text")
    .text(function(d) { return d.text; })
    .attr("class", function(d,i) { 
        if (i === activeButtonId) {
            return "buttonText active";
        }
        else {
            return "buttonText inactive";
        }
    })
    .attr("text-anchor", "middle")
    .attr("x", function(d) { return d.width/2; })
    .attr("y", 5)
    .attr("id", function(d, i) { return "text" + i; })
    .attr("fill", "#FFF")
    .attr("opacity", function(d,i) {
        if (i === activeButtonId) return 1;
        else return 0;
    });

// http://stackoverflow.com/questions/9063383/how-to-invoke-click-event-programmaticaly-in-d3
jQuery.fn.mouseevent = function (type) {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent(type, true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
    e.dispatchEvent(evt);
  });
};

</script>

</body>